# 智谱AI饮食记录助手

基于智谱AI API的智能饮食记录助手，采用模块化架构设计，支持自然对话、饮食记录、消费统计和可视化分析。

## ✨ 功能特点

### 🎯 智能意图识别
- 混合检测算法：关键词匹配 + LLM验证
- 快速响应：大部分意图识别<100ms
- 高准确率：智能区分闲聊和数据记录需求

### 📝 饮食记录管理
- 自动记录饮食信息（日期、食物、金额）
- 智能信息补全提示
- 历史记录查询和统计

### 📊 数据分析可视化
- 消费统计分析
- 饮食习惯分析
- 自动生成图表和报告

### 🛠️ 文件操作支持
- 读取和写入文件
- 目录列表功能
- 多编码支持

### 🏗️ 模块化架构
- 清晰的代码结构
- 易于扩展和维护
- 高性能和内存管理

## 🏗️ 架构设计

```
app/
├── core/           # 核心配置和模型
│   ├── config.py  # 配置管理
│   └── models.py  # 自定义模型适配器
├── agents/         # Agent实现
│   ├── base_agent.py      # Agent基类
│   ├── chat_agent.py      # 闲聊Agent
│   └── record_agent.py    # 记录Agent
├── tools/          # 工具函数
│   ├── tool_registry.py   # 工具注册机制
│   ├── food_tools.py      # 食物相关工具
│   ├── file_tools.py      # 文件操作工具
│   └── stats_tools.py     # 统计工具
└── utils/          # 工具类
    ├── intent_detector.py # 意图检测
    └── session_manager.py # 会话管理
```

## 🚀 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 配置环境变量
复制环境变量模板：
```bash
cp .env.template .env
```

编辑 `.env` 文件，填入你的API密钥：
```bash
ZHIPUAI_API_KEY=your_api_key_here
MODEL_NAME=glm-4.5-flash
MAX_SESSIONS=100
SESSION_TIMEOUT=3600
```

### 3. 运行应用
```bash
# 使用启动脚本（推荐）
python run.py

# 或者直接运行
python main.py
```

### 4. 开始对话
```
🚀 正在初始化智谱AI饮食记录助手...
📁 模块化架构版本

==================================================
🎉 欢迎使用智谱AI饮食记录助手！
💡 功能特点：
   • 智能意图识别
   • 饮食记录管理
   • 消费统计分析
   • 文件操作支持
   • 可视化图表生成
==================================================
📝 输入'退出'或'exit'结束对话
📊 当前活跃会话数: 1
--------------------------------------------------
你: 今天我吃了牛肉面，花了35元
🎯 识别意图: record
📝 使用记录Agent处理...
助手: 已记录：今天吃了牛肉面，花费35元
--------------------------------------------------
```

## 💡 使用示例

### 饮食记录
```
你: 昨天午饭我吃了炸鸡，花了45元
你: 2024年1月15日早餐喝了咖啡，花了20元
```

### 数据查询
```
你: 查看我的所有记录
你: 统计我的总消费
你: 生成消费统计图表
```

### 文件操作
```
你: 读取config.txt文件
你: 列出当前目录的文件
```

### 闲聊对话
```
你: 今天天气怎么样？
你: 给我讲个笑话
```

## 🔧 高级配置

### 环境变量
| 变量名 | 描述 | 默认值 |
|--------|------|--------|
| `ZHIPUAI_API_KEY` | 智谱AI API密钥 | 必需 |
| `MODEL_NAME` | 模型名称 | `glm-4.5-flash` |
| `MAX_TOKENS` | 最大令牌数 | `1000` |
| `TEMPERATURE` | 温度参数 | `0.1` |
| `MAX_SESSIONS` | 最大会话数 | `100` |
| `SESSION_TIMEOUT` | 会话超时时间（秒） | `3600` |
| `DATABASE_PATH` | 数据库路径 | `agent_records.db` |

### 数据库结构
系统使用SQLite数据库存储：

**饮食记录表 (`eating_records`)**
- `id`: 主键
- `date`: 日期
- `food`: 食物
- `money`: 金额
- `created_at`: 创建时间

**函数调用日志表 (`function_calls`)**
- `id`: 主键
- `function_name`: 函数名称
- `arguments`: 函数参数（JSON）
- `called_at`: 调用时间

## 🛠️ 开发说明

### 添加新工具
1. 在相应的工具模块中定义新函数
2. 使用 `@tool` 装饰器
3. 在 `main.py` 中注册工具

### 扩展Agent
1. 继承 `BaseAgent` 类
2. 实现必要的方法
3. 在主应用中集成

### 自定义配置
1. 修改 `app/core/config.py`
2. 添加新的配置项
3. 更新环境变量模板

## 📈 性能优化

### 意图检测优化
- 关键词匹配：快速识别常见意图
- LLM验证：处理复杂情况
- 缓存机制：避免重复调用

### 内存管理
- 自动清理过期会话
- 会话数量限制
- 资源使用监控

### 数据库优化
- 参数化查询防止SQL注入
- 连接池管理
- 索引优化

## 🤝 贡献指南

1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 发起 Pull Request

## 📄 许可证

本项目采用 MIT 许可证。

## 🆘 支持

如有问题，请创建 Issue 或联系开发者。 